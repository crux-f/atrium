# Tag the caster
tag @a[predicate=atrium:travelers_best_friend_req] add travelers_best_friend_caster
# Sounds and particles
execute as @a[tag=travelers_best_friend_caster] at @s run playsound minecraft:block.enchantment_table.use player @a[distance=..30] ~ ~ ~ 1 1.25 0.1
execute as @a[tag=travelers_best_friend_caster] at @s anchored eyes run particle minecraft:enchant ^0.4 ^-0.05 ^0.5 0.05 0.05 0.05 0.1 10
#
# Give one wolf that hasn't been upgraded by this a buff based on the trophy used.
# [AS the caster AT the caster's location, anchored at the caster's eyes instead of feet, 3 block FORWARD from where they're looking, pick the closest wolf without a tier 1 upgrade.]
#
execute as @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{skeleton_trophy:1b}}}] at @s anchored eyes positioned ^ ^ ^3 run data merge entity @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full] {PersistenceRequired:1b,ArmorItems:[{id:"minecraft:chainmail_boots",Count:1b,tag:{display:{Name:'{"text":"Ricochet Pelt","color":"gray","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,ricochet_pelt:1b,Enchantments:[{id:"minecraft:projectile_protection",lvl:1s}]}},{id:"minecraft:chainmail_leggings",Count:1b,tag:{display:{Name:'{"text":"Ricochet Pelt","color":"gray","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,ricochet_pelt:1b,Enchantments:[{id:"minecraft:projectile_protection",lvl:1s}]}},{id:"minecraft:chainmail_chestplate",Count:1b,tag:{display:{Name:'{"text":"Ricochet Pelt","color":"gray","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,ricochet_pelt:1b,Enchantments:[{id:"minecraft:projectile_protection",lvl:1s}]}},{id:"minecraft:chainmail_helmet",Count:1b,tag:{display:{Name:'{"text":"Ricochet Pelt","color":"gray","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,ricochet_pelt:1b,Enchantments:[{id:"minecraft:projectile_protection",lvl:1s}]}}],ArmorDropChances:[0.000F,0.000F,0.000F,0.000F]}
execute as @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{phantom_trophy:1b}}}] at @s anchored eyes positioned ^ ^ ^3 run data merge entity @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full] {PersistenceRequired:1b,ArmorItems:[{id:"minecraft:chainmail_boots",Count:1b,tag:{display:{Name:'{"text":"Springy Paws","color":"green","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,springy_paws:1b,Enchantments:[{id:"minecraft:feather_falling",lvl:3s}]}},{id:"minecraft:chainmail_leggings",Count:1b,tag:{display:{Name:'{"text":"Springy Paws","color":"green","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,springy_paws:1b,Enchantments:[{id:"minecraft:feather_falling",lvl:1s}]}},{id:"minecraft:chainmail_chestplate",Count:1b,tag:{display:{Name:'{"text":"Springy Paws","color":"green","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,springy_paws:1b,Enchantments:[{id:"minecraft:blast_protection",lvl:1s}]}},{id:"minecraft:chainmail_helmet",Count:1b,tag:{display:{Name:'{"text":"Springy Paws","color":"green","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,springy_paws:1b,Enchantments:[{id:"minecraft:blast_protection",lvl:1s}]}}],ArmorDropChances:[0.000F,0.000F,0.000F,0.000F]}
execute as @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{zombie_trophy:1b}}}] at @s anchored eyes positioned ^ ^ ^3 run data merge entity @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full] {PersistenceRequired:1b,ArmorItems:[{id:"minecraft:chainmail_boots",Count:1b,tag:{display:{Name:'{"text":"Tracking","color":"dark_green","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,tracking:1b,Enchantments:[{id:"minecraft:protection",lvl:1s}],AttributeModifiers:[{AttributeName:"generic.follow_range",Name:"generic.follow_range",Amount:0.25,Operation:1,UUID:[I;1926256370,1056393432,-1649159459,322345664],Slot:"feet"}]}},{id:"minecraft:chainmail_leggings",Count:1b,tag:{display:{Name:'{"text":"Tracking","color":"dark_green","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,tracking:1b,Enchantments:[{id:"minecraft:protection",lvl:1s}],AttributeModifiers:[{AttributeName:"generic.follow_range",Name:"generic.follow_range",Amount:0.25,Operation:1,UUID:[I;-577991975,1509246243,-1247306276,52367517],Slot:"legs"}]}},{id:"minecraft:chainmail_chestplate",Count:1b,tag:{display:{Name:'{"text":"Tracking","color":"dark_green","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,tracking:1b,Enchantments:[{id:"minecraft:protection",lvl:1s}],AttributeModifiers:[{AttributeName:"generic.follow_range",Name:"generic.follow_range",Amount:0.25,Operation:1,UUID:[I;1862172452,1317554682,-2098932511,-1113677208],Slot:"chest"}]}},{id:"minecraft:chainmail_helmet",Count:1b,tag:{display:{Name:'{"text":"Tracking","color":"dark_green","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,tracking:1b,Enchantments:[{id:"minecraft:protection",lvl:1s}],AttributeModifiers:[{AttributeName:"generic.follow_range",Name:"generic.follow_range",Amount:0.25,Operation:1,UUID:[I;-1455126729,-508672688,-1964875585,1372036658],Slot:"head"}]}}],ArmorDropChances:[0.000F,0.000F,0.000F,0.000F]}
execute as @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{spider_trophy:1b}}}] at @s anchored eyes positioned ^ ^ ^3 run data merge entity @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full] {PersistenceRequired:1b,ArmorItems:[{id:"minecraft:chainmail_boots",Count:1b,tag:{display:{Name:'{"text":"Hounding","color":"red","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,hounding:1b,AttributeModifiers:[{AttributeName:"generic.movement_speed",Name:"generic.movement_speed",Amount:0.1,Operation:1,UUID:[I;275593922,114640423,-1739115731,-1595539959],Slot:"feet"}]}},{id:"minecraft:chainmail_leggings",Count:1b,tag:{display:{Name:'{"text":"Hounding","color":"red","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,hounding:1b,AttributeModifiers:[{AttributeName:"generic.movement_speed",Name:"generic.movement_speed",Amount:0.1,Operation:1,UUID:[I;-1130631683,1997555196,-1556109519,-1520466983],Slot:"legs"}]}},{id:"minecraft:chainmail_chestplate",Count:1b,tag:{display:{Name:'{"text":"Hounding","color":"red","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,hounding:1b,AttributeModifiers:[{AttributeName:"generic.movement_speed",Name:"generic.movement_speed",Amount:0.1,Operation:1,UUID:[I;-1360265662,-594851189,-1276974013,1161095348],Slot:"chest"}]}},{id:"minecraft:chainmail_helmet",Count:1b,tag:{display:{Name:'{"text":"Hounding","color":"red","italic":false}',Lore:['{"text":"Ideally, this isn\'t visible."}']},Unbreakable:1b,hounding:1b,AttributeModifiers:[{AttributeName:"generic.movement_speed",Name:"generic.movement_speed",Amount:0.1,Operation:1,UUID:[I;320296871,-1052488015,-1520053999,-951621248],Slot:"head"}]}}],ArmorDropChances:[0.000F,0.000F,0.000F,0.000F]}
# Tag the entity with the upgrade it got
execute as @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{skeleton_trophy:1b}}}] at @s anchored eyes positioned ^ ^ ^3 run tag @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full] add ricochet_pelt
execute as @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{phantom_trophy:1b}}}] at @s anchored eyes positioned ^ ^ ^3 run tag @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full] add springy_paws
execute as @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{zombie_trophy:1b}}}] at @s anchored eyes positioned ^ ^ ^3 run tag @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full] add tracking
execute as @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{spider_trophy:1b}}}] at @s anchored eyes positioned ^ ^ ^3 run tag @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full] add hounding
#
# Particles at target
execute as @a[tag=travelers_best_friend_caster] at @s anchored eyes positioned ^ ^ ^3 run execute as @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full,tag=ricochet_pelt] at @s run particle dust 0.871 0.871 0.871 1 ~ ~ ~ 0.5 0.5 0.5 1 50 normal
execute as @a[tag=travelers_best_friend_caster] at @s anchored eyes positioned ^ ^ ^3 run execute as @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full,tag=springy_paws] at @s run particle dust 0.388 1.000 0.451 1 ~ ~ ~ 0.5 0.5 0.5 1 50 normal
execute as @a[tag=travelers_best_friend_caster] at @s anchored eyes positioned ^ ^ ^3 run execute as @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full,tag=tracking] at @s run particle dust 0.020 0.471 0.078 1 ~ ~ ~ 0.5 0.5 0.5 1 50 normal
execute as @a[tag=travelers_best_friend_caster] at @s anchored eyes positioned ^ ^ ^3 run execute as @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full,tag=hounding] at @s run particle dust 0.588 0.000 0.000 1 ~ ~ ~ 0.5 0.5 0.5 1 50 normal
# Tag the entity to mark the tier 1 slot as full
execute as @a[tag=travelers_best_friend_caster] at @s anchored eyes positioned ^ ^ ^3 run tag @e[limit=1,type=minecraft:wolf,sort=nearest,distance=..5,tag=!wolf_tier1_full] add wolf_tier1_full
# cleanup
clear @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{skeleton_trophy:1b}}}] minecraft:skeleton_skull{skeleton_trophy:1b} 1
clear @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{phantom_trophy:1b}}}] minecraft:player_head{phantom_trophy:1b} 1
clear @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{zombie_trophy:1b}}}] minecraft:zombie_head{zombie_trophy:1b} 1
clear @a[tag=travelers_best_friend_caster,nbt={SelectedItem:{tag:{spider_trophy:1b}}}] minecraft:player_head{spider_trophy:1b} 1
# Spell cleanup
function atrium:magic/magicitems/spell_cast_complete
tag @a[tag=travelers_best_friend_caster] remove travelers_best_friend_caster
