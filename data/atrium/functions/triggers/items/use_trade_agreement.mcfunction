# Activated by right-clicking on a Master level villager with a Trade Agreement
# Revoke to allow re-trigger
advancement revoke @s only atrium:triggers/items/use_trade_agreement
#
# Let the player know that they can't use a trade agreement on the same person more than once
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,type=minecraft:villager,nbt={VillagerData:{level:5}},sort=nearest,distance=..5] if data entity @s {Offers:{Recipes:[{buy:{tag:{atrium_shipment:1b}}}]}} run tellraw @p[gamemode=!spectator] {"text":"(This villager has already signed a trade agreement.)","italic":true,"color":"red"}
# Failure sound
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,type=minecraft:villager,nbt={VillagerData:{level:5}},sort=nearest,distance=..5] if data entity @s {Offers:{Recipes:[{buy:{tag:{atrium_shipment:1b}}}]}} run playsound minecraft:entity.villager.no player @a[distance=..5] ~ ~ ~ 0.5 1 0.1
# Tag the villager if the villager is a valid target
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,type=minecraft:villager,nbt={VillagerData:{level:5}},sort=nearest,distance=..5] unless data entity @s {Offers:{Recipes:[{buy:{tag:{atrium_shipment:1b}}}]}} run tag @s add atrium_signing_agreement
# Success sound
execute at @s if entity @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] run playsound minecraft:entity.villager.yes player @s ~ ~ ~ 0.5 1 0.1
# Assign new Shipment trade depending on profession
#
# Armorer / Tinker = Coal Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:armorer"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"Coal Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_coal_shipment:1b,SkullOwner:{Id:[I;-968692717,1039615507,-1801077148,1569674872],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvOTczMWJmMjRmMzI2YTY5ZTA0NTM3NTU2OTA3YmIxMjFhZjMxZmEwZjQzMDQzMjNjNWNjMTU5ZDRmN2JmNjRhZSJ9fX0="}]}},BlockEntityTag:{note_block_sound:"minecraft:block.furnace.fire_crackle"}}},sell:{id:"minecraft:emerald",Count:22b}}
# Butcher / Chef
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:butcher"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"Honeycomb Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_honeycomb_shipment:1b,SkullOwner:{Id:[I;427655650,582438885,-1744643910,1719778533],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvM2U2Yjc2ZWM1YWYzMzJiZWU3NGNhZTNhYjQ3ZjQxNzJlZDI0MmM1M2Y4Mzc0YzQ3Y2FkNzE5ODIwZGUyNjY4OCJ9fX0="}]}},BlockEntityTag:{note_block_sound:"minecraft:block.beehive.work"}}},sell:{id:"minecraft:emerald",Count:22b}}
# Cartographer / Collector
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:cartographer"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"Sculk Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_sculk_shipment:1b,SkullOwner:{Id:[I;-1924161547,-1370469891,-1411012779,-1249575780],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvN2I3Y2Y3NzcyMDI5OTdiYjZhMTViMDg2MzRkY2U5YTU0YWE1NjQwNDYwYzEzMWM5YmFiYjhkZjFhZDI4NjEzZCJ9fX0="}]}},BlockEntityTag:{note_block_sound:"minecraft:block.sculk.spread"}}},sell:{id:"minecraft:emerald",Count:32b}}
# Cleric / Alienist
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:cleric"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"Amethyst Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_amethyst_shipment:1b,SkullOwner:{Id:[I;643777309,1068648088,-1632131889,1179553826],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvYjk2MjNkYTBmZGFmMzFkMzJiMmQwMWMyNTdhZGU1NDQyZGFhMjM3ZTI1MmM4OTA2ZTJiNTIxMTNhMmY4ZDAwZCJ9fX0="}]}},BlockEntityTag:{note_block_sound:"minecraft:block.amethyst_block.place"}}},sell:{id:"minecraft:emerald",Count:22b}}
# Farmer / Beekeeper
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:farmer"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"Melon Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_melon_shipment:1b,SkullOwner:{Id:[I;1934491042,1718896624,-2033317110,-989934615],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvMTdiY2UxZjFlZWJmZmVlZTU5YzJkNTNmYTBkMmMyN2VlNWIwNzg0YjE5NWJiYTliNTAwODk2ZGUzYmNhZWJkIn19fQ=="}]}},BlockEntityTag:{note_block_sound:"minecraft:entity.player.burp"}}},sell:{id:"minecraft:emerald",Count:22b}}
# Fisher / Merchant
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:fisherman"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"Blue Ice Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_blue_ice_shipment:1b,SkullOwner:{Id:[I;1129184674,1718896624,-2033317110,-989934615],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNWY0YTYwYjY3NjE4NWRlNjJmN2Q5M2VkOTQ0MGI4Y2ZiMjU4ZjUxNjFmZjcwZjNhODhlOWFiYjI4ODJkZGY0MCJ9fX0="}]}},BlockEntityTag:{note_block_sound:"minecraft:block.glass.place"}}},sell:{id:"minecraft:emerald",Count:22b}}
# Fletcher / Hunter
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:fletcher"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"Hay Bale Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_hay_bale_shipment:1b,SkullOwner:{Id:[I;-966595565,1039615507,883277412,1569674872],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZDY5YWM5NzZlZjQ4NDQ3Nzc2YmZmZmY3MGRmNjZjZWViNGE1ZGFjNTA1YjEzZjE3MjEyM2UxNGNkMzc1OTE4MSJ9fX0="}]}},BlockEntityTag:{note_block_sound:"minecraft:block.grass.place"}}},sell:{id:"minecraft:emerald",Count:22b}}
# Leatherworker / Alchemist
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:leatherworker"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"Mud Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_mud_shipment:1b,SkullOwner:{Id:[I;-2133477506,1644250523,-1496765920,-1059641667],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvMmM5YTI2NzFhOTE3NTIzZjNlZTM5ZTM4NDhhMTM0MGMwNjgxYTRhM2FhYmI3OTgxNGJiMDRjODQ2OGQxYjc4MCJ9fX0="}]}},BlockEntityTag:{note_block_sound:"minecraft:block.mud.place"}}},sell:{id:"minecraft:emerald",Count:22b}}
# Librarian / Enchanter
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:librarian"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"Lapis Lazuli Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_lapis_lazuli_shipment:1b,SkullOwner:{Id:[I;373484563,1039615507,-1801077148,1569674872],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvN2Q0ZGM5OWYxZGFjYmI0MjY0NDExOWFjYTMxNTZmZjZjZjIzN2I2ZTJjYWI5OGUyZGNiOThmMTgyNzNkMTU3MSJ9fX0="}]}},BlockEntityTag:{note_block_sound:"minecraft:block.enchantment_table.use"}}},sell:{id:"minecraft:emerald",Count:22b}}
# Mason / Architect
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:mason"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"Stone Shipment","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_stone_shipment:1b,SkullOwner:{Id:[I;622679,-1008581947,-1593539288,384904868],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNjdhMzliZDcwZmQ1ZGI4MDU3Y2RiMzNkN2Q2OTMwZjYwMWI4YzljOTU4MTRkODRkYTUzMzMyMDZhMTAxMTYyNCJ9fX0="}]}},BlockEntityTag:{note_block_sound:"minecraft:block.stone.place"}}},sell:{id:"minecraft:emerald",Count:22b}}
# Shepherd / Artist
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:shepherd"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"White Wool Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_white_wool_shipment:1b,SkullOwner:{Id:[I;-532476745,-2013967220,-1221480822,24952546],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZGI5ODZhMDIzMDIxZWRkYjZmOGYyZWM0YTczNzRhNzFhYmFiM2I5Yjc5YWY1MzUyNGNmN2QzNmUwMjcxNzMwZiJ9fX0="}]}},BlockEntityTag:{note_block_sound:"minecraft:block.wool.place"}}},sell:{id:"minecraft:emerald",Count:22b}}
# Toolsmith / Engineer
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:toolsmith"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"TNT Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_tnt_shipment:1b,SkullOwner:{Id:[I;-582987483,1103774018,-1421710496,1168599964],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvMzNmOGE5ZmUzMzM5YzJmMjI3MDRiZjFjMDMzOTRkZjA3MWVlNGVmM2Q3MmVlYmVhYWJhZjMxMDVjZmZlMTQyIn19fQ=="}]}},BlockEntityTag:{note_block_sound:"minecraft:entity.tnt.primed"}}},sell:{id:"minecraft:emerald",Count:48b}}
# Weaponsmith / Warrior
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:weaponsmith"}} run data modify entity @s Offers.Recipes append value {rewardExp:1b,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",Count:1b,tag:{display:{Name:'{"text":"Iron Ore Shipment","color":"yellow","italic":false}',Lore:['{"text":"Highly tradable."}']},atrium_shipment:1b,atrium_iron_ore_shipment:1b,SkullOwner:{Id:[I;-15441679,511593355,-2147448581,223302038],Properties:{textures:[{Value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNmM3NjI4ZTg5N2NiNGM5MzEyZjgwMmYyOGMyZWM0NjZkN2U3MjFlYzM3MDEwMzc4Y2M0NWRkMmRjNjg4MTBjMyJ9fX0="}]}},BlockEntityTag:{note_block_sound:"minecraft:entity.iron_golem.repair"}}},sell:{id:"minecraft:emerald",Count:32b}}
#
# Consume the Trade Agreement if it was used
execute at @s if entity @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] run clear @s minecraft:paper{atrium_trade_agreement:1b} 1
# Remove the tag afterwards
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] run tag @s remove atrium_signing_agreement