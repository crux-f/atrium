# Activated by right-clicking on a Master level villager with a Trade Agreement
# Revoke to allow re-trigger
advancement revoke @s only atrium:triggers/items/use_trade_agreement
#
# Let the player know that they can't use a trade agreement on the same person more than once
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,type=minecraft:villager,nbt={VillagerData:{level:5}},sort=nearest,distance=..5] if data entity @s {Offers:{Recipes:[{buy:{components:{"minecraft:custom_data":{atrium_shipment:1b}}}}]}} run tellraw @p[gamemode=!spectator] {"text":"(This villager has already signed a trade agreement.)","italic":true,"color":"red"}
# Failure sound
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,type=minecraft:villager,nbt={VillagerData:{level:5}},sort=nearest,distance=..5] if data entity @s {Offers:{Recipes:[{buy:{components:{"minecraft:custom_data":{atrium_shipment:1b}}}}]}} run playsound minecraft:entity.villager.no player @a[distance=..5] ~ ~ ~ 0.5 1 0.1
# Tag the villager if the villager is a valid target
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,type=minecraft:villager,nbt={VillagerData:{level:5}},sort=nearest,distance=..5] unless data entity @s {Offers:{Recipes:[{buy:{components:{"minecraft:custom_data":{atrium_shipment:1b}}}}]}} run tag @s add atrium_signing_agreement
# PLUGIN FIX: Tag the villager to allow it to be exempt from vanilla trade removal in the CustomVillagerTrades plugin that we use on Atrium.
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,type=minecraft:villager,nbt={VillagerData:{level:5}},sort=nearest,distance=..5] unless data entity @s {Offers:{Recipes:[{buy:{components:{"minecraft:custom_data":{atrium_shipment:1b}}}}]}} run tag @s add cvt_trade_override
# Success sound
execute at @s if entity @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] run playsound minecraft:entity.villager.yes player @s ~ ~ ~ 0.5 1 0.1
# Assign new Shipment trade depending on profession
#
# Armorer / Tinker = Coal Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:armorer"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:block.furnace.fire_crackle","minecraft:item_name":{text:"Coal Shipment"},"minecraft:profile":{id:[I;-968692717,1039615507,-1801077148,1569674872],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvOTczMWJmMjRmMzI2YTY5ZTA0NTM3NTU2OTA3YmIxMjFhZjMxZmEwZjQzMDQzMjNjNWNjMTU5ZDRmN2JmNjRhZSJ9fX0="}]},"minecraft:custom_data":{atrium_coal_shipment:1b,atrium_shipment:1b}}},sell:{id:"minecraft:emerald",count:22}}
# Butcher / Chef = Honeycomb Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:butcher"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:block.beehive.work","minecraft:item_name":{text:"Honeycomb Shipment"},"minecraft:profile":{id:[I;427655650,582438885,-1744643910,1719778533],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvM2U2Yjc2ZWM1YWYzMzJiZWU3NGNhZTNhYjQ3ZjQxNzJlZDI0MmM1M2Y4Mzc0YzQ3Y2FkNzE5ODIwZGUyNjY4OCJ9fX0="}]},"minecraft:custom_data":{atrium_honeycomb_shipment:1b,atrium_shipment:1b}}},sell:{id:"minecraft:emerald",count:22}}
# Cartographer / Collector = Sculk Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:cartographer"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:block.sculk.spread","minecraft:item_name":{text:"Sculk Shipment"},"minecraft:profile":{id:[I;-1924161547,-1370469891,-1411012779,-1249575780],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvN2I3Y2Y3NzcyMDI5OTdiYjZhMTViMDg2MzRkY2U5YTU0YWE1NjQwNDYwYzEzMWM5YmFiYjhkZjFhZDI4NjEzZCJ9fX0="}]},"minecraft:custom_data":{atrium_sculk_shipment:1b,atrium_shipment:1b}}},sell:{id:"minecraft:emerald",count:32}}
# Cleric / Alienist = Amethyst Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:cleric"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:block.amethyst_block.place","minecraft:item_name":{text:"Amethyst Shipment"},"minecraft:profile":{id:[I;643777309,1068648088,-1632131889,1179553826],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvYjk2MjNkYTBmZGFmMzFkMzJiMmQwMWMyNTdhZGU1NDQyZGFhMjM3ZTI1MmM4OTA2ZTJiNTIxMTNhMmY4ZDAwZCJ9fX0="}]},"minecraft:custom_data":{atrium_amethyst_shipment:1b,atrium_shipment:1b}}},sell:{id:"minecraft:emerald",count:22}}
# Farmer / Beekeeper = Melon Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:farmer"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:entity.player.burp","minecraft:item_name":{text:"Melon Shipment"},"minecraft:profile":{id:[I;1934491042,1718896624,-2033317110,-989934615],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvMTdiY2UxZjFlZWJmZmVlZTU5YzJkNTNmYTBkMmMyN2VlNWIwNzg0YjE5NWJiYTliNTAwODk2ZGUzYmNhZWJkIn19fQ=="}]},"minecraft:custom_data":{atrium_melon_shipment:1b,atrium_shipment:1b}}},sell:{id:"minecraft:emerald",count:22}}
# Fisher / Merchant = Blue Ice Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:fisherman"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:block.glass.place","minecraft:item_name":{text:"Blue Ice Shipment"},"minecraft:profile":{id:[I;1129184674,1718896624,-2033317110,-989934615],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNWY0YTYwYjY3NjE4NWRlNjJmN2Q5M2VkOTQ0MGI4Y2ZiMjU4ZjUxNjFmZjcwZjNhODhlOWFiYjI4ODJkZGY0MCJ9fX0="}]},"minecraft:custom_data":{atrium_blue_ice_shipment:1b,atrium_shipment:1b}}},sell:{id:"minecraft:emerald",count:22}}
# Fletcher / Hunter = Hay Bale Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:fletcher"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:block.grass.place","minecraft:item_name":{text:"Hay Bale Shipment"},"minecraft:profile":{id:[I;-966595565,1039615507,883277412,1569674872],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZDY5YWM5NzZlZjQ4NDQ3Nzc2YmZmZmY3MGRmNjZjZWViNGE1ZGFjNTA1YjEzZjE3MjEyM2UxNGNkMzc1OTE4MSJ9fX0="}]},"minecraft:custom_data":{atrium_hay_bale_shipment:1b,atrium_shipment:1b}}},sell:{id:"minecraft:emerald",count:22}}
# Leatherworker / Alchemist = Mud Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:leatherworker"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:block.mud.place","minecraft:item_name":{text:"Mud Shipment"},"minecraft:profile":{id:[I;-2133477506,1644250523,-1496765920,-1059641667],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvMmM5YTI2NzFhOTE3NTIzZjNlZTM5ZTM4NDhhMTM0MGMwNjgxYTRhM2FhYmI3OTgxNGJiMDRjODQ2OGQxYjc4MCJ9fX0="}]},"minecraft:custom_data":{atrium_mud_shipment:1b,atrium_shipment:1b}}},sell:{id:"minecraft:emerald",count:22}}
# Librarian / Enchanter = Lapis Lazuli Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:librarian"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:block.enchantment_table.use","minecraft:item_name":{text:"Lapis Lazuli Shipment"},"minecraft:profile":{id:[I;373484563,1039615507,-1801077148,1569674872],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvN2Q0ZGM5OWYxZGFjYmI0MjY0NDExOWFjYTMxNTZmZjZjZjIzN2I2ZTJjYWI5OGUyZGNiOThmMTgyNzNkMTU3MSJ9fX0="}]},"minecraft:custom_data":{atrium_lapis_lazuli_shipment:1b,atrium_shipment:1b}}},sell:{id:"minecraft:emerald",count:22}}
# Mason / Architect = Stone Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:mason"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:block.stone.place","minecraft:item_name":{text:"Stone Shipment"},"minecraft:profile":{id:[I;622679,-1008581947,-1593539288,384904868],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNjdhMzliZDcwZmQ1ZGI4MDU3Y2RiMzNkN2Q2OTMwZjYwMWI4YzljOTU4MTRkODRkYTUzMzMyMDZhMTAxMTYyNCJ9fX0="}]},"minecraft:custom_data":{atrium_shipment:1b,atrium_stone_shipment:1b}}},sell:{id:"minecraft:emerald",count:22}}
# Shepherd / Artist = White Wool Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:shepherd"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:block.wool.place","minecraft:item_name":{text:"White Wool Shipment"},"minecraft:profile":{id:[I;-532476745,-2013967220,-1221480822,24952546],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZGI5ODZhMDIzMDIxZWRkYjZmOGYyZWM0YTczNzRhNzFhYmFiM2I5Yjc5YWY1MzUyNGNmN2QzNmUwMjcxNzMwZiJ9fX0="}]},"minecraft:custom_data":{atrium_shipment:1b,atrium_white_wool_shipment:1b}}},sell:{id:"minecraft:emerald",count:22}}
# Toolsmith / Engineer = TNT Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:toolsmith"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:block.slime_block.place","minecraft:item_name":{text:"Slime Block Shipment"},"minecraft:profile":{id:[I;1397620130,1718896624,-2033317110,-989934615],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZjFkMDQ4MDk3NTMwYjU0ZTgzM2FkZGJlNTJiZjU2MWI3NzJiYWQwYWY4MDM3MTNmZDE5NGVhMDQxM2YwMDlkZiJ9fX0="}]},"minecraft:custom_data":{atrium_shipment:1b,atrium_slime_block_shipment:1b}}},sell:{id:"minecraft:emerald",count:32}}
# Weaponsmith / Warrior = Iron Ore Shipment
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] if data entity @s {VillagerData:{profession:"minecraft:weaponsmith"}} run data modify entity @s Offers.Recipes append value {rewardExp:true,maxUses:16,xp:0,priceMultiplier:0.05f,buy:{id:"minecraft:player_head",count:1,components:{"minecraft:lore":[{text:"Highly tradable."}],"minecraft:note_block_sound":"minecraft:entity.iron_golem.repair","minecraft:item_name":{text:"Iron Ore Shipment"},"minecraft:profile":{id:[I;-15441679,511593355,-2147448581,223302038],properties:[{name:"textures",value:"eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNmM3NjI4ZTg5N2NiNGM5MzEyZjgwMmYyOGMyZWM0NjZkN2U3MjFlYzM3MDEwMzc4Y2M0NWRkMmRjNjg4MTBjMyJ9fX0="}]},"minecraft:custom_data":{atrium_iron_ore_shipment:1b,atrium_shipment:1b}}},sell:{id:"minecraft:emerald",count:32}}
#
# Consume the Trade Agreement if it was used
execute at @s if entity @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] run clear @s minecraft:paper[minecraft:custom_data={atrium_trade_agreement:1b}] 1
# Remove the tag afterwards
execute at @s positioned ^ ^ ^1.5 as @e[limit=1,tag=atrium_signing_agreement,sort=nearest,distance=..5] run tag @s remove atrium_signing_agreement