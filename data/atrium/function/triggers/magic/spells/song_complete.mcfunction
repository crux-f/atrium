# Summon the disc used to cast the spell as a glowing magical disc that can't be picked up for the duration of the song.
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_5"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:3560,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_5"],Item:{id:"minecraft:disc_fragment_5",count:9}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_11"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:1420,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_11"],Item:{id:"minecraft:music_disc_11",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_13"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:3540,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_13"],Item:{id:"minecraft:music_disc_13",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_blocks"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:6860,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_blocks"],Item:{id:"minecraft:music_disc_blocks",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_cat"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:3720,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_cat"],Item:{id:"minecraft:music_disc_cat",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_chirp"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:3740,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_chirp"],Item:{id:"minecraft:music_disc_chirp",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_creator"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:3520,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_creator"],Item:{id:"minecraft:music_disc_creator",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_creator_music_box"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:1460,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_creator_music_box"],Item:{id:"minecraft:music_disc_creator_music_box",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_far"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:3840,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_far"],Item:{id:"minecraft:music_disc_far",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_mall"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:3960,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_mall"],Item:{id:"minecraft:music_disc_mall",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_mellohi"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:1960,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_mellohi"],Item:{id:"minecraft:music_disc_mellohi",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_otherside"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:3900,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_otherside"],Item:{id:"minecraft:music_disc_otherside",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_pigstep"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:2960,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_pigstep"],Item:{id:"minecraft:music_disc_pigstep",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_precipice"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:5980,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_precipice"],Item:{id:"minecraft:music_disc_precipice",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_relic"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:4360,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_relic"],Item:{id:"minecraft:music_disc_relic",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_stal"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:3040,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_stal"],Item:{id:"minecraft:music_disc_stal",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_strad"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:3780,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_strad"],Item:{id:"minecraft:music_disc_strad",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_wait"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:4680,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_wait"],Item:{id:"minecraft:music_disc_wait",count:1}}
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_ward"}}] run summon item ~ ~ ~ {NoGravity:1b,Glowing:1b,Age:-10000,Health:25,PickupDelay:5000,Motion:[0.0,0.1,0.0],Tags:["atrium_floating_disc","song_spell_ward"],Item:{id:"minecraft:music_disc_ward",count:1}}
#
# If the disc was 5, play the item breaking sound.
execute as @a[tag=atrium_song_caster] at @s[nbt={SelectedItem:{id:"minecraft:music_disc_5"}}] run playsound minecraft:item.shield.break record @a[distance=..15] ~ ~ ~ 1 2 0.1
#
# If the disc was Strad, give a funny meme advancement
execute as @a[tag=atrium_song_caster] if entity @s[nbt={SelectedItem:{id:"minecraft:music_disc_strad"}}] run advancement grant @s only atrium:magic/curse_of_strad
#
# If you didn't animate a disc, play failure sounds + display failure particles.
execute as @a[tag=atrium_song_caster] at @s unless entity @e[tag=atrium_floating_disc,distance=..20] run particle minecraft:smoke ^ ^ ^1.5 0.03 0.03 0.03 0 50
execute as @a[tag=atrium_song_caster] at @s unless entity @e[tag=atrium_floating_disc,distance=..20] run playsound minecraft:block.redstone_torch.burnout master @a[distance=..30] ~ ~ ~ 0.3 1 0.1
execute as @a[tag=atrium_song_caster] at @s unless entity @e[tag=atrium_floating_disc,distance=..20] run tellraw @s {"text":"(Need a Music Disc to cast this.)","italic":true,"color":"gray"}
#
# Remove 1 Music Disc (casting component cost) from your off hand (luckily discs do not stack so this is fine)
execute as @a[tag=atrium_song_caster] run item replace entity @s weapon.mainhand with air
#
# Start the Song
execute at @e[tag=song_spell_5] run playsound minecraft:music_disc.5 record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_11] run playsound minecraft:music_disc.11 record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_13] run playsound minecraft:music_disc.13 record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_blocks] run playsound minecraft:music_disc.blocks record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_cat] run playsound minecraft:music_disc.cat record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_chirp] run playsound minecraft:music_disc.chirp record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_creator] run playsound minecraft:music_disc.creator record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_creator_music_box] run playsound minecraft:music_disc.creator_music_box record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_far] run playsound minecraft:music_disc.far record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_mall] run playsound minecraft:music_disc.mall record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_mellohi] run playsound minecraft:music_disc.mellohi record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_otherside] run playsound minecraft:music_disc.otherside record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_pigstep] run playsound minecraft:music_disc.pigstep record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_precipice] run playsound minecraft:music_disc.precipice record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_relic] run playsound minecraft:music_disc.relic record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_stal] run playsound minecraft:music_disc.stal record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_strad] run playsound minecraft:music_disc.strad record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_wait] run playsound minecraft:music_disc.wait record @a[distance=..15] ~ ~ ~ 1 1 0.1
execute at @e[tag=song_spell_ward] run playsound minecraft:music_disc.ward record @a[distance=..15] ~ ~ ~ 1 1 0.1
#
# Start the repeat script (one for each song)
execute if entity @e[tag=song_spell_5] run function atrium:triggers/magic/spells/song/ss_5
execute if entity @e[tag=song_spell_11] run function atrium:triggers/magic/spells/song/ss_11
execute if entity @e[tag=song_spell_13] run function atrium:triggers/magic/spells/song/ss_13
execute if entity @e[tag=song_spell_blocks] run function atrium:triggers/magic/spells/song/ss_blocks
execute if entity @e[tag=song_spell_cat] run function atrium:triggers/magic/spells/song/ss_cat
execute if entity @e[tag=song_spell_chirp] run function atrium:triggers/magic/spells/song/ss_chirp
execute if entity @e[tag=song_spell_creator] run function atrium:triggers/magic/spells/song/ss_creator
execute if entity @e[tag=song_spell_creator_music_box] run function atrium:triggers/magic/spells/song/ss_creator_music_box
execute if entity @e[tag=song_spell_far] run function atrium:triggers/magic/spells/song/ss_far
execute if entity @e[tag=song_spell_mall] run function atrium:triggers/magic/spells/song/ss_mall
execute if entity @e[tag=song_spell_mellohi] run function atrium:triggers/magic/spells/song/ss_mellohi
execute if entity @e[tag=song_spell_otherside] run function atrium:triggers/magic/spells/song/ss_otherside
execute if entity @e[tag=song_spell_pigstep] run function atrium:triggers/magic/spells/song/ss_pigstep
execute if entity @e[tag=song_spell_precipice] run function atrium:triggers/magic/spells/song/ss_precipice
execute if entity @e[tag=song_spell_stal] run function atrium:triggers/magic/spells/song/ss_stal
execute if entity @e[tag=song_spell_strad] run function atrium:triggers/magic/spells/song/ss_strad
execute if entity @e[tag=song_spell_wait] run function atrium:triggers/magic/spells/song/ss_wait
execute if entity @e[tag=song_spell_ward] run function atrium:triggers/magic/spells/song/ss_ward
execute if entity @e[tag=song_spell_relic] run function atrium:triggers/magic/spells/song/ss_relic
#
# Other fx
function atrium:triggers/magic/spells/song/disc_cushion_fx
#
# Remove caster tag if they didn't cast successfully
execute as @a[tag=atrium_song_caster] at @s unless entity @e[tag=atrium_floating_disc,distance=..20] run tag @s remove atrium_song_caster