# Increase each entity's hiding score by 1 if they aren't currently targeting a player
execute as @e[tag=atrium_currently_hiding,predicate=!atrium:entity/is_targeting_survival_player] unless entity @s[scores={atrium_hiding=31..}] run scoreboard players add @s atrium_hiding 1
execute at @e[tag=atrium_currently_hiding,predicate=!atrium:entity/is_targeting_survival_player,scores={atrium_hiding=..29}] run particle minecraft:smoke ~ ~0.25 ~ 0.5 1 0.5 0 1
#
# If any of them had long enough to hide (30 seconds), remove handitems and set silent
execute as @e[tag=atrium_currently_hiding,scores={atrium_hiding=30}] run data remove entity @s HandItems
execute as @e[tag=atrium_currently_hiding,scores={atrium_hiding=30}] run data modify entity @s Silent set value true
# Evokers are too god damn fast for stealth. Slow down, dude.
# execute as @e[tag=atrium_currently_hiding,tag=atrium_armada_necromancer,scores={atrium_hiding=30..}] run effect give @s minecraft:slowness 3 1 true
#
# come out of hiding if in battle
# Restore items + turn off silent
execute as @e[tag=atrium_currently_hiding,tag=atrium_looting_party_leader,scores={atrium_hiding=30..}] at @s if entity @a[distance=..15,gamemode=survival] run data merge entity @s {Silent:false,Team:"atrium_armada",PersistenceRequired:1b,Health:34f,Tags:["atrium_armada_crusader"],CustomName:'{"color":"yellow","text":"Armada Crusader"}',HandItems:[{id:"minecraft:iron_sword",count:1,components:{"minecraft:enchantments":{levels:{"minecraft:fire_aspect":2,"minecraft:knockback":3,"minecraft:sharpness":1,"minecraft:unbreaking":2}},"minecraft:item_name":'"Crusader\'s Broadsword"',"minecraft:rarity":"uncommon","minecraft:lore":['"The emblem of The Armada"','"is carved into the blade."','"A weapon forged to destroy you."'],"minecraft:custom_data":{atrium_crusaders_broadsword:1b}}},{id:"minecraft:shield",count:1,components:{"minecraft:banner_patterns":[{color:"black",pattern:"minecraft:creeper"},{color:"black",pattern:"minecraft:rhombus"}],"minecraft:attribute_modifiers":[{id:"armor",type:"armor",amount:2,operation:"add_value",slot:"offhand"}],"minecraft:base_color":"purple","minecraft:custom_name":'{"italic":false,"text":"Armada Shield"}'}}],HandDropChances:[0.050F,0.450F],ArmorItems:[{id:"minecraft:iron_boots",count:1,components:{"minecraft:enchantments":{levels:{"minecraft:feather_falling":3,"minecraft:projectile_protection":2}}}},{id:"minecraft:iron_leggings",count:1,components:{"minecraft:enchantments":{levels:{"minecraft:projectile_protection":2}}}},{id:"minecraft:iron_chestplate",count:1,components:{"minecraft:enchantments":{levels:{"minecraft:projectile_protection":2}}}},{id:"minecraft:purple_dye",count:1,components:{"minecraft:custom_model_data":{strings:["atrium_armada_trooper"]}}}],ArmorDropChances:[0.000F,0.000F,0.000F,0.000F],attributes:[{id:"minecraft:follow_range",base:32},{id:"minecraft:max_health",base:34}]}
execute as @e[tag=atrium_currently_hiding,tag=atrium_armada_looter,scores={atrium_hiding=30..}] at @s if entity @a[distance=..15,gamemode=survival] run data merge entity @s {Silent:0b,Team:"armada",PersistenceRequired:1b,Health:35f,Tags:["atrium_armada_looter","atrium_currently_hiding"],CustomName:'{"text":"Armada Looter","color":"yellow","italic":false}',HandItems:[{id:"minecraft:crossbow",Count:1b,tag:{Enchantments:[{id:"minecraft:piercing",lvl:2s},{id:"minecraft:quick_charge",lvl:1s}]}},{id:"minecraft:tipped_arrow",Count:2b,tag:{display:{Name:'{"text":"Negative Energy Bolt","color":"dark_gray","italic":false}',Lore:['{"text":"Infused with dark magic,"}','{"text":"these crossbow bolts are"}','{"text":"only granted to operatives"}','{"text":"involved in missions of"}','{"text":"great import."}']},atrium_negative_energy_bolt:1b,CustomPotionEffects:[{Id:7,Amplifier:0b,Duration:1,ShowParticles:1b}],CustomPotionColor:3158064}}],HandDropChances:[0.000F,0.500F],Attributes:[{Name:"generic.max_health",Base:35}]}
# execute as @e[tag=atrium_currently_hiding,tag=atrium_armada_necromancer,scores={atrium_hiding=30..}] at @s if entity @a[distance=..15,gamemode=survival] run data merge entity @s {Silent:0b,Team:"armada",PersistenceRequired:1b,Health:48f,Tags:["atrium_armada_necromancer","atrium_currently_hiding"],CustomName:'{"text":"Armada Necromancer","color":"red","italic":false}',Attributes:[{Name:"generic.max_health",Base:48}]}
execute as @e[tag=atrium_currently_hiding,predicate=atrium:entity/is_targeting_survival_player] at @s if entity @a[distance=..15,gamemode=survival] run scoreboard players set @s atrium_hiding 10
#
# Run again in 1 second if an event is still going on
execute if entity @a[tag=event] run schedule function atrium_events:summon/armada/behavior_scripts/looters/looter_hide 1s